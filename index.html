<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VulcÃ£o de Santa Barbara Shake - Version 2.0</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="VulcÃ£o de Santa Barbara Shake" />
  <link rel="apple-touch-icon" href="icon-512.png" />

  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Mobile Menu Button -->
  <button id="mobile-menu-btn" aria-label="Toggle menu">â˜°</button>

  <div id="app">
    <!-- SIDEBAR -->
    <div id="sidebar">
      <!-- Sidebar Header -->
      <div id="sidebar-header">
        <button id="sidebar-toggle" aria-label="Collapse sidebar" title="Collapse sidebar">â—€</button>
      </div>

      <!-- IPMA Logo -->
      <div class="sidebar-logo-section">
        <img src="ipma-logo.png" alt="IPMA" />
        <small>Dados sÃ­smicos fornecidos pela Rede SÃ­smica Nacional â€“ IPMA.pt</small>
      </div>

      <!-- App Logo -->
      <div class="sidebar-logo-section">
        <img src="app-logo.png" alt="App Logo" class="app-logo" />
      </div>

      <h1>Sismos â€“ Serra de Santa BÃ¡rbara</h1>
      <small>Ãšltimos 30 dias â€¢ Raio 30 km â€¢ 3D local</small>

      <div id="ultima-atualizacao">AtualizaÃ§Ã£o: â€”</div>

      <!-- Search -->
      <div id="search-container">
        <input 
          type="text" 
          id="search-input" 
          placeholder="Pesquisar sismos..." 
          aria-label="Search earthquakes"
        />
      </div>

      <!-- Filters Panel -->
      <div class="collapsible-panel">
        <div class="panel-header">
          <h3 data-i18n="filters">Filtros</h3>
          <button class="panel-toggle" aria-label="Toggle filters">â–¼</button>
        </div>
        <div class="panel-content">
          <!-- Magnitude Filter -->
          <div class="filter-group">
            <label class="filter-label" for="filter-mag-min">Magnitude</label>
            <input 
              type="range" 
              id="filter-mag-min" 
              class="filter-range" 
              min="0" 
              max="6" 
              step="0.1" 
              value="0"
              aria-label="Minimum magnitude"
            />
            <input 
              type="range" 
              id="filter-mag-max" 
              class="filter-range" 
              min="0" 
              max="6" 
              step="0.1" 
              value="6"
              aria-label="Maximum magnitude"
            />
            <div class="filter-value" id="filter-mag-value">0.0 - 6.0</div>
            <div class="filter-quick-buttons">
              <button class="filter-quick-btn" data-mag="2.0">â‰¥ 2.0</button>
              <button class="filter-quick-btn" data-mag="3.0">â‰¥ 3.0</button>
              <button class="filter-quick-btn" data-mag="4.0">â‰¥ 4.0</button>
              <button class="filter-quick-btn" data-mag="5.0">â‰¥ 5.0</button>
            </div>
          </div>

          <!-- Depth Filter -->
          <div class="filter-group">
            <label class="filter-label" for="filter-depth-min">Profundidade (km)</label>
            <input 
              type="range" 
              id="filter-depth-min" 
              class="filter-range" 
              min="0" 
              max="30" 
              step="0.5" 
              value="0"
              aria-label="Minimum depth"
            />
            <input 
              type="range" 
              id="filter-depth-max" 
              class="filter-range" 
              min="0" 
              max="30" 
              step="0.5" 
              value="30"
              aria-label="Maximum depth"
            />
            <div class="filter-value" id="filter-depth-value">0.0 - 30.0 km</div>
            <div class="filter-quick-buttons">
              <button class="filter-quick-btn" data-depth-type="surface">SuperfÃ­cie</button>
              <button class="filter-quick-btn" data-depth-type="shallow">Raso &lt;5km</button>
              <button class="filter-quick-btn" data-depth-type="medium">MÃ©dio 5-15km</button>
              <button class="filter-quick-btn" data-depth-type="deep">Profundo &gt;15km</button>
            </div>
          </div>

          <!-- Date Range Filter -->
          <div class="filter-group">
            <label class="filter-label" for="filter-date-range">PerÃ­odo</label>
            <select id="filter-date-range" class="setting-control" aria-label="Date range">
              <option value="7">Ãšltimos 7 dias</option>
              <option value="14">Ãšltimos 14 dias</option>
              <option value="30" selected>Ãšltimos 30 dias</option>
              <option value="60">Ãšltimos 60 dias</option>
              <option value="90">Ãšltimos 90 dias</option>
            </select>
          </div>

          <!-- Radius Filter -->
          <div class="filter-group">
            <label class="filter-label" for="filter-radius">Raio (km)</label>
            <input 
              type="range" 
              id="filter-radius" 
              class="filter-range" 
              min="5" 
              max="50" 
              step="5" 
              value="30"
              aria-label="Search radius"
            />
            <div class="filter-value" id="filter-radius-value">30 km</div>
          </div>

          <button id="clear-filters" class="btn">Limpar Filtros</button>
        </div>
      </div>

      <!-- Statistics Panel -->
      <div class="collapsible-panel">
        <div class="panel-header">
          <h3 data-i18n="statistics">EstatÃ­sticas <span id="active-filters-badge" style="display:none;">0</span></h3>
          <button class="panel-toggle" aria-label="Toggle statistics">â–¼</button>
        </div>
        <div class="panel-content" id="statistics-content">
          <p style="text-align:center; color: var(--text-secondary);">Carregando...</p>
        </div>
      </div>

      <!-- Settings Panel -->
      <div class="collapsible-panel">
        <div class="panel-header">
          <h3 data-i18n="settings">ConfiguraÃ§Ãµes</h3>
          <button class="panel-toggle" aria-label="Toggle settings">â–¼</button>
        </div>
        <div class="panel-content">
          <!-- Language -->
          <div class="setting-item">
            <label class="setting-label" for="setting-language">Idioma</label>
            <select id="setting-language" class="setting-control">
              <option value="pt">PortuguÃªs</option>
              <option value="en">English</option>
              <option value="es">EspaÃ±ol</option>
            </select>
          </div>

          <!-- Theme -->
          <div class="setting-item">
            <label class="setting-label" for="setting-theme">Tema</label>
            <select id="setting-theme" class="setting-control">
              <option value="dark">Escuro</option>
              <option value="light">Claro</option>
              <option value="auto">AutomÃ¡tico</option>
            </select>
          </div>

          <!-- Visualization Settings -->
          <div class="setting-item">
            <div class="setting-toggle">
              <label class="setting-label">Mostrar VulcÃ£o</label>
              <div class="toggle-switch active" data-setting="showVolcano" role="button" tabindex="0" aria-label="Toggle volcano display"></div>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-toggle">
              <label class="setting-label">Mostrar BÃºssola</label>
              <div class="toggle-switch active" data-setting="showCompass" role="button" tabindex="0" aria-label="Toggle compass display"></div>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-toggle">
              <label class="setting-label">Mostrar SuperfÃ­cie</label>
              <div class="toggle-switch active" data-setting="showSurface" role="button" tabindex="0" aria-label="Toggle surface display"></div>
            </div>
          </div>

          <!-- Accessibility -->
          <div class="setting-item">
            <div class="setting-toggle">
              <label class="setting-label">Alto Contraste</label>
              <div class="toggle-switch" data-setting="highContrast" role="button" tabindex="0" aria-label="Toggle high contrast"></div>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-toggle">
              <label class="setting-label">Movimento Reduzido</label>
              <div class="toggle-switch" data-setting="reducedMotion" role="button" tabindex="0" aria-label="Toggle reduced motion"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="btn-group" style="margin-top: 15px; width: 100%;">
        <button class="btn btn-primary" onclick="exportData('csv')" style="flex: 1;">
          ðŸ“¥ CSV
        </button>
        <button class="btn btn-primary" onclick="exportData('json')" style="flex: 1;">
          ðŸ“¥ JSON
        </button>
        <button class="btn btn-primary" onclick="exportData('geojson')" style="flex: 1;">
          ðŸ“¥ GeoJSON
        </button>
      </div>

      <button class="btn" onclick="shareView()" style="width: 100%; margin-top: 10px;">
        ðŸ”— Partilhar
      </button>

      <!-- Earthquake List -->
      <h2 style="font-size: 14px; margin-top: 20px; margin-bottom: 10px;">Lista de Sismos</h2>
      <ul id="lista-sismos">
        <li>Carregando dados do IPMAâ€¦</li>
      </ul>

      <div class="sidebar-footer">
        Fonte dos dados: <strong>IPMA.pt</strong><br>
        Sistema local: X/Y (km), Z (km â€“ negativo abaixo da superfÃ­cie)
      </div>
    </div>

    <!-- GRAPH CONTAINER -->
    <div id="grafico-container">
      <div id="marca-logos">
        <img src="vost-portugal.png" class="marca-logo" alt="VOST Portugal">
        <img src="VOSTAZ_f.png" class="marca-logo" alt="VOSTAZ">
      </div>
      <div id="grafico"></div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Footer -->
  <div class="footer-global">
    2025, Criado por LuÃ­s Serpa e melhorado por IA. Dados IPMA.PT. â€¢ 
    <a href="about.html">Sobre</a>
  </div>

  <!-- Main Application Script -->
  <script src="app.js"></script>

  <!-- Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("service-worker.js")
          .catch(err => console.warn("SW falhou:", err));
      });
    }
  </script>
</body>
</html>

